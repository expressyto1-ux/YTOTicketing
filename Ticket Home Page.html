<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>YTO IT Ticket System</title>

    <style>
        :root {
            --brand: #6d28d9;
            --brand-2: #2563eb;
            --muted: #9ca3af;
            --surface-dark: #1e293b;
            --shadow: 0 12px 35px rgba(0, 0, 0, 0.35);
            --radius: 12px;
            --transition: 0.25s ease;
        }

        body {
            --bg: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            --text: #0f172a;
            --surface: rgba(255, 255, 255, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: "Lexend", system-ui, -apple-system, "Lexend", Lexend;
            min-height: 100vh;
            background: var(--bg) fixed;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 90px;
            transition: background var(--transition), color var(--transition);
        }

        /* NAV */
        nav a {
            text-decoration: none;
            color: var(--text);
            padding: 8px 14px;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
        }

        nav a:hover {
            background: var(--brand);
            color: #fff;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 22px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        nav img {
            height: 42px
        }

        .nav-links {
            display: flex;
            gap: 18px;
            align-items: center;
        }

        .nav-links a,
        .nav-links button {
            color: var(--text);
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
            padding: 8px 12px;
            border-radius: 8px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .nav-links button:hover {
            background: var(--brand-2);
            color: #fff
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 36px
        }

        header img {
            height: 150px;
            margin-bottom: 8px
        }

        header h1 {
            font-size: 24px;
            margin-bottom: 6px
        }

        header p {
            color: var(--muted)
        }

        /* CARDS */
        .card-container {
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 28px;
            padding: 0 20px;
        }

        .card {
            background: var(--surface);
            padding: 26px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: transform var(--transition), background var(--transition);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            background: linear-gradient(135deg, var(--brand), var(--brand-2));
            color: #fff
        }

        .card-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 16px;
            color: #fff;
        }

        .card:nth-child(1) .card-icon {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .card:nth-child(2) .card-icon {
            background: linear-gradient(135deg, #ec4899, #db2777);
        }

        .card:nth-child(3) .card-icon {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }


        .card h2 {
            font-size: 18px;
            margin: 10px 0
        }

        .card p {
            color: var(--muted);
            margin-bottom: 16px
        }

        /* FOOTER */
        footer {
            margin: 50px 0 24px;
            color: var(--muted);
            font-size: 13px;
            text-align: center
        }

        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex
        }

        .modal-content {
            width: 70%;
            max-width: 720px;
            margin: 0 auto;
            /* Removed top margin to allow flexbox to center it */
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--text);
            padding: 22px;
            box-shadow: var(--shadow);
            position: relative;
            animation: modalFade .32s ease;
        }

        @keyframes modalFade {
            from {
                transform: translateY(-8px);
                opacity: 0
            }

            to {
                transform: none;
                opacity: 1
            }
        }

        /* Add cursor styles for draggability */
        #requestModal .modal-content {
            cursor: grab;
        }

        #requestModal .modal-content:active {
            cursor: grabbing;
        }


        /* New: Overlay for generating ticket number */
        .generating-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.8);
            z-index: 10;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            color: var(--text);
            text-align: center;
            padding: 20px;
        }

        .generating-overlay .spinner {
            width: 40px;
            height: 40px;
            border: 5px solid rgba(100, 116, 139, 0.3);
            border-top-color: var(--brand);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }


        .modal-header {
            text-align: center;
            margin-bottom: 18px
        }

        .modal-header h2 {
            font-size: 20px;
            margin: 0
        }


        /* SEARCH modal small tweaks */
        #ticketModal .modal-content {
            max-width: 720px
        }

        #ticketModal input[type="text"] {
            width: 70%;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid rgba(19, 6, 138, 0.1);
            margin-right: 10px;
            background: #fff;
            color: var(--text);
        }

        #ticketModal button {
            background: linear-gradient(90deg, #2563eb, #1d4ed8);
            color: #fff;
            font-weight: 700;
            padding: 10px 18px;
            border-radius: 8px;
            border: 2px solid #1e40af;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 3px 0 #1e3a8a, 0 6px 12px rgba(0, 0, 0, 0.25);
            transition: all 0.2s ease;
        }

        #ticketModal button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #1e3a8a, 0 8px 16px rgba(0, 0, 0, 0.35);
            background: linear-gradient(90deg, #1d4ed8, #2563eb);
        }

        #ticketModal button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1e3a8a, 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* FORM styles (optimized & brand-themed) */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }

        .form-grid .full {
            grid-column: 1/-1
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--muted)
        }

        input[type="text"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #111;
            transition: box-shadow var(--transition), border var(--transition);
        }

        input:focus,
        select:focus,
        textarea:focus {
            box-shadow: 0 0 8px rgba(37, 99, 235, 0.12);
            border-color: var(--brand-2);
            outline: none
        }

        textarea {
            min-height: 110px;
            resize: vertical
        }

        .error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.08) !important
        }

        .submit-row {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            align-items: center
        }

        .submit-row .submit-btn {
            background: linear-gradient(90deg, #09456d, #053868);
            color: #fff;
            font-weight: 700;
            padding: 12px 20px;
            border-radius: 10px;
            border: 2px solid #1e40af;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 0 #1e3a8a, 0 6px 12px rgba(0, 0, 0, 0.25);
            transition: all 0.2s ease;
            width: 100%;
            /* full width like in your modal */
        }

        .submit-row .submit-btn {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1e3a8a, 0 8px 16px rgba(0, 0, 0, 0.35);
            background: linear-gradient(90deg, #1d4ed8, #2563eb);
        }

        .submit-row .submit-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1e3a8a, 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .small-btn {
            padding: 12px 14px;
            border-radius: 10px;
            border: 4px;
            background: #1f8ed8;
            color: #fff;
            cursor: pointer
        }

        /* toast */
        .toast {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10010;
            min-width: 320px;
            max-width: 400px;
            padding: 14px 18px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            color: #fff;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: top 0.4s ease, opacity 0.4s ease;
        }

        .toast.show {
            top: 25px;
            opacity: 1;
        }

        .toast-icon {
            font-size: 22px;
        }

        .toast.success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }



        /* success modal with brand gradient */
        .success-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(30, 41, 59, 0.6);
            align-items: center;
            justify-content: center;
            z-index: 10020
        }

        .success-content {
            width: 90%;
            max-width: 420px;
            border-radius: 12px;
            padding: 24px;
            background: linear-gradient(135deg, var(--brand), var(--brand-2));
            color: #fff;
            text-align: center;
            box-shadow: var(--shadow);
            animation: slideDown 0.36s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0
            }

            to {
                transform: none;
                opacity: 1
            }
        }

        .success-content p {
            margin: 12px 0 18px;
            font-weight: 700;
            font-size: 18px
        }

        /* spinner overlay (fade in/out) */
        .spinner-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10030;
            align-items: center;
            justify-content: center;
            transition: opacity 0.22s ease;
        }

        .spinner-overlay.show {
            display: flex;
            opacity: 1
        }

        .spinner-box {
            width: 92px;
            height: 92px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .spinner {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 6px solid rgba(0, 0, 0, 0.1);
            border-top-color: var(--brand);
            animation: spin 0.9s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0)
            }

            to {
                transform: rotate(360deg)
            }
        }

        /* Responsive adjustments */
        @media (max-width:880px) {
            .form-grid {
                grid-template-columns: 1fr
            }

            .modal-content {
                margin: 8% 12px
            }
        }

        @media (max-width:480px) {
            .nav-links {
                gap: 10px
            }

            header h1 {
                font-size: 18px
            }

            .card {
                padding: 18px
            }

            .card-icon {
                width: 64px;
                height: 64px;
                line-height: 64px;
                font-size: 28px
            }

            .submit-row {
                flex-direction: column
            }

            .submit-row .submit-btn {
                width: 100%
            }
        }

        .close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 28px;
            font-weight: bold;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close:hover {
            color: #1f2937;
        }

        #ticketInput {
            padding: 12px 14px;
            font-size: 17px;
            border: 2px solid #cbd5e1;
            /* light gray border */
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s;
        }

        #ticketInput:focus {
            border-color: #9c0884;
            /* blue border when focused */
            box-shadow: 0 0 0 2px rgba(231, 38, 206, 0.2);
        }

        .card-btn {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            width: 100%;
            /* make button span full card width */
            padding: 14px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
            color: #fff;
        }

        .card-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* Color themes */
        .card-btn.blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .card-btn.pink {
            background: linear-gradient(135deg, #ec4899, #db2777);
        }

        .card-btn.green {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .card-btn span {
            font-size: 16px;
        }

        .hero {
            text-align: center;
            margin: 40px auto 30px;
            max-width: 900px;
        }

        .hero-logo {
            height: 80px;
            margin-bottom: 20px;
        }

        .hero-title-main {
            display: block;
            font-size: 48px;
            /* big bold size */
            font-weight: 800;
            color: #1e293b;
            line-height: 1.2;
        }

        .hero-title-sub {
            display: block;
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(90deg, #2563eb, #6d28d9);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-tagline {
            font-size: 16px;
            color: #475569;
            margin-top: 10px;
            font-weight: 400;
        }

        /* Make inputs white inside search modal */
        #ticketModal input[type="text"],
        #ticketModal select,
        #ticketModal textarea {
            background: #fff;
            color: #111;
            /* dark text */
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }

        /* Placeholder color (lighter gray) */
        #ticketModal input::placeholder,
        #ticketModal textarea::placeholder {
            color: #777;
        }

        #pageModal .modal-content.large {
            max-width: 960px;
            /* wider than normal */
            width: 90%;
            height: auto;
            background: var(--surface);
            border-radius: 12px;
            padding: 20px;
        }

        /* Centered smaller iframe modal */
        #pageModal .modal-content.large {
            max-width: 720px;
            /* width of the modal */
            width: 70%;
            /* responsive */
            height: auto;
            padding: 0;
            /* remove inner spacing */
            border-radius: 12px;
            overflow: hidden;
            /* cut off scrollbars/extra */
            background: #fff;
            /* clean white wrapper */
            box-sizing: border-box;
            /* ensure no extra spacing */
        }

        /* Iframe inside modal (fills 100%) */
        #pageFrame {
            width: 75%;
            height: 400px;
            /* control modal height */
            border: none;
            margin: 0;
            display: block;
            /* removes inline whitespace */
        }

        .modal-content iframe {
            width: 420px;
            /* match login form width */
            height: 500px;
            /* adjust height */
            border: none;
        }

        /* Page entry animation */
        body {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        body.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        /* Card staggered reveal */
        .card {
            opacity: 0;
            transform: translateY(20px);
            animation: cardFadeUp 0.6s ease forwards;
        }

        .card:nth-child(1) {
            animation-delay: 0.4s;
        }

        .card:nth-child(2) {
            animation-delay: 0.6s;
        }

        .card:nth-child(3) {
            animation-delay: 0.8s;
        }

        @keyframes cardFadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* === MODAL CARD STYLES (for Security & Register) === */
        .modal .modal-card {
            width: 480px;
            max-width: 95%;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            color: var(--text);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 22px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .modal .modal-card .modal-header h2 {
            color: var(--brand);
        }

        /* === LOGIN MODAL STYLES (from Ticket IT Login.html) === */
        #loginModal {
            position: fixed;
            inset: 0;
            z-index: 9998;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        #loginModal .card {
            width: 420px;
            max-width: 95%;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            color: var(--text);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        #loginModal .card-top {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 6px 14px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        #loginModal .logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            background: linear-gradient(135deg, #6d28d9, #2563eb);
            color: white;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            animation: logoPulse 2200ms ease-in-out infinite;
        }

        @keyframes logoPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.03);
            }
        }

        #loginModal .heading .title {
            font-size: 16px;
            font-weight: 800;
        }

        #loginModal .heading .sub {
            font-size: 12px;
            color: var(--muted);
        }

        #loginModal .card-body {
            padding: 14px 4px 6px;
        }

        #loginModal .field {
            position: relative;
            margin: 14px 0;
        }

        .modal-card .field {
            position: relative;
            margin: 14px 0;
        }

        #loginModal .input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb !important;
            color: #000 !important;
            font-size: 14px;
        }

        .modal-card .input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb !important;
            color: #000 !important;
            font-size: 14px;
        }


        #loginModal .label {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            color: #6b7280;
            opacity: .6;
            transition: all 180ms cubic-bezier(.2, .9, .2, 1);
        }

        .modal-card .label {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            color: #6b7280;
            opacity: .6;
            transition: all 180ms cubic-bezier(.2, .9, .2, 1);
        }

        #loginModal .input:focus+.label,
        #loginModal .input:not(:placeholder-shown)+.label {
            transform: translateY(-165%);
            font-size: 12px;
            color: #2563eb;
            opacity: 1;
        }

        .modal-card .input:focus+.label,
        .modal-card .input:not(:placeholder-shown)+.label {
            transform: translateY(-165%);
            font-size: 12px;
            color: var(--brand);
            opacity: 1;
        }

        #loginModal .toggle-pass {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
        }

        #loginModal .row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--muted);
        }

        #loginModal .actions {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #loginModal .btn {
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #loginModal .btn.primary {
            background: linear-gradient(90deg, #6d28d9, #2563eb);
            color: #fff;
        }

        .modal-card .btn.primary {
            background: linear-gradient(90deg, #6d28d9, #2563eb);
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #loginModal .btn.secondary {
            background: #475569;
            color: #fff;
        }

        .modal-card .btn.secondary {
            background: #475569;
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #loginModal .hint {
            font-size: 12px;
            color: #9ca3af;
            text-align: center;
            margin-top: 6px;
        }

        #loginModal .footer {
            padding: 12px 4px 6px;
            text-align: center;
            font-size: 12px;
            color: var(--muted);
        }


        /* === NEW: Manual Icon Style === */
        #manualIcon {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 9990;
            /* Keep it below modals */
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: pulseManualIcon 2s infinite ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            /* Ensures the image stays within the circle */
        }

        #manualIcon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #manualIcon:hover {
            transform: translateY(-3px) scale(1.05);
            animation-play-state: paused;
            /* Pause animation on hover */
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.35);
        }

        /* === NEW: Manual Icon Notification Bubble === */
        #manualNotification {
            position: fixed;
            bottom: 35px;
            /* Position above the icon */
            right: 85px;
            /* Position to the left of the icon */
            background: linear-gradient(135deg, #6d28d9, #db2777);
            color: #fff;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 9991;
            /* Above the icon, below modals */
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }

        .result {
            background: rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 15px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            /* ✅ Better alignment */
            row-gap: 12px;
            column-gap: 10px;
        }

        .label {
            font-weight: bold;
            color: #64748b;
            /* Lighter label color for contrast */
            text-align: right;
            padding-right: 10px;
        }

        .value {
            text-align: left;
            color: var(--text);
        }

        /* === WEATHER EFFECTS === */
        #weather-effects-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #weather-effects-container.show {
            opacity: 1;
        }

        .rain-drop {
            position: absolute;
            bottom: 100%;
            width: 1px;
            height: 60px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4));
            animation: fall 0.5s linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .snowflake {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            top: -10px;
            animation: fall-snow 10s linear infinite;
        }

        @keyframes fall-snow {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) translateX(100px) rotate(360deg);
                opacity: 1;
            }
        }

        .sun-ray {
            position: absolute;
            top: -50px;
            left: 50%;
            width: 2px;
            height: 150px;
            background: linear-gradient(to bottom, rgba(255, 255, 180, 0.5), transparent);
            transform-origin: top center;
            animation: shine 5s ease-in-out infinite;
        }

        @keyframes shine {

            0%,
            100% {
                opacity: 0;
                transform: scaleY(0.8);
            }

            50% {
                opacity: 1;
                transform: scaleY(1);
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="logo-container">
            <img src="https://imgur.com/ykZQl3d.png" alt="YTO Logo" />
            <div>
                <h2 style="margin:0; font-size:18px; font-weight:700; color: #1e293b;">YTO IT Express Ticket System</h2>
                <p style="margin:0; font-size:13px; color: #475569;">Technology Group Corporation</p>
            </div>
        </div>

        <div class="nav-links">
            <button onclick="openLoginModal()">📊 Dashboard Login</button>
            <button onclick="openRequestModal()">📝 Submit Ticket</button>
            <button onclick="openTicketModal()">🔍 Search Ticket</button>
        </div>
    </nav>

    <header>
        <img src="https://imgur.com/ykZQl3d.png" alt="YTO Logo" />
        <h1>
            <span class="hero-title-main">YTO Express Philippines</span>
            <span class="hero-title-sub">Technology Group Corporation</span>
        </h1>
        <p class="hero-tagline">
            IT Ticketing System – Central Dashboard for seamless technical support and IT issue resolution
        </p>
    </header>

    <main class="card-container" role="main">
        <div class="card" onclick="openLoginModal()">
            <div class="card-icon">📊</div>
            <h2>IT Ticket Dashboard</h2>
            <p>Monitor all submitted tickets in real-time. For IT Personnel use Only</p>
            <button class="card-btn blue">
                Login and Open Dashboard
            </button>
        </div>

        <div class="card" onclick="openRequestModal()">
            <div class="card-icon">📝</div>
            <h2>Submit New Ticket</h2>
            <p>Report IT issues quickly and get prompt support.</p>
            <button class="card-btn blue">Submit New Ticket Request</button>
        </div>

        <div class="card" onclick="openTicketModal()">
            <div class="card-icon">🔍</div>
            <h2>Search Ticket</h2>
            <p>Lookup existing tickets, check their status, and view details.</p>
            <button class="card-btn blue">Search Your Ticket Status Now</button>
        </div>
    </main>

    <footer>© 2025 Not Owned by YTO Express Philippines Technology Group</footer>

    <!-- Manual Icon -->
    <a id="manualIcon" href="End User Manual.html" target="_blank" title="Open End User Manual">
        <img src="https://i.imgur.com/fM3Hfju.png" alt="User Manual">
    </a>

    <!-- NEW: Manual Icon Notification -->
    <div id="manualNotification">Click Me for User's Manual</div>


    <!-- LOGIN MODAL -->
    <div id="loginModal" class="modal" aria-hidden="true">
        <main class="card" role="main" aria-labelledby="appTitle">
            <span class="close" onclick="closeLoginModal()" title="Close">&times;</span>
            <div class="card-top">
                <div class="logo" aria-hidden="true">IT</div>
                <div class="heading" id="appTitle">
                    <div class="title">IT Ticket Monitoring</div>
                    <div class="sub">Sign in with your assigned IT account</div>
                </div>
            </div>

            <section class="card-body">
                <form id="loginForm" autocomplete="on" novalidate>
                    <div class="field">
                        <input id="username" class="input" type="text" placeholder=" " required />
                        <label for="username" class="label">Username</label>
                    </div>

                    <div class="field">
                        <input id="password" class="input" type="password" placeholder=" " required />
                        <label for="password" class="label">Password</label>
                        <button type="button" id="togglePass" class="toggle-pass"
                            aria-label="Show/hide password">👁</button>
                    </div>

                    <div class="row">
                        <label><input id="remember" type="checkbox"> Remember me</label>
                        <a href="#" onclick="alert('Contact IT admin to reset password');return false;">Forgot?</a>
                    </div>

                    <div class="actions">
                        <button id="loginBtn" class="btn primary" type="submit">Sign In</button>
                        <button id="createAccountBtn" class="btn secondary" type="button">Create account</button>
                        <div class="hint">By continuing, you agree to the IT usage policy.</div>
                    </div>
                </form>
            </section>

            <div class="footer">© <span id="yr"></span> YTO Express (PH) — Technology Group</div>
        </main>
    </div>

    <!-- Security Modal (for registration) -->
    <div id="securityModal" class="modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="secTitle">
            <span class="close" onclick="closeSecurityModal()" title="Close">&times;</span>
            <div id="secTitle" class="modal-header">
                <h2>IT Security Check</h2>
            </div>
            <div class="field">
                <input id="securityInput" class="input" type="password" placeholder=" " required />
                <label for="securityInput" class="label">IT Security Password</label>
            </div>
            <div style="margin-top:16px; text-align:right; display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="closeSecurityModal()" class="btn secondary" type="button">Cancel</button>
                <button id="secConfirm" class="btn primary" type="button">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="regTitle">
            <span class="close" onclick="closeRegisterModal()" title="Close">&times;</span>
            <div id="regTitle" class="modal-header">
                <h2>Create Account</h2>
            </div>

            <div style="text-align: center; margin-bottom: 16px;">
                <img id="profilePicPreview" src="https://i.imgur.com/8bXVn5d.png" alt="Profile Preview"
                    style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--brand-2); cursor: pointer;"
                    onclick="document.getElementById('regProfilePic').click();">
                <input type="file" id="regProfilePic" accept="image/*" style="display: none;">
                <p style="font-size: 12px; opacity: 0.7; margin-top: 6px;">Click image to upload</p>
            </div>

            <div class="field"><input id="regFullName" class="input" type="text" placeholder=" " required /><label
                    for="regFullName" class="label">Full Name</label></div>
            <div class="field"><input id="regUsername" class="input" type="text" placeholder=" " required /><label
                    for="regUsername" class="label">Username</label></div>
            <div class="field"><input id="regPassword" class="input" type="password" placeholder=" " required /><label
                    for="regPassword" class="label">Password</label></div>

            <fieldset
                style="margin-top: 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 12px; text-align: left;">
                <legend style="font-weight: 600; padding: 0 8px; color: var(--muted);">Assign Regions</legend>
                <div id="regionCheckboxes"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; font-size: 13px;">
                    <label><input type="checkbox" name="regions" value="Batangas Operation"> Batangas</label>
                    <label><input type="checkbox" name="regions" value="Cavite Operation"> Cavite</label>
                    <label><input type="checkbox" name="regions" value="Laguna Operation"> Laguna</label>
                    <label><input type="checkbox" name="regions" value="CARMONA Operation"> CARMONA</label>
                    <label><input type="checkbox" name="regions" value="Bulacan Operation"> Bulacan</label>
                    <label><input type="checkbox" name="regions" value="Manila Operation"> Manila</label>
                    <label><input type="checkbox" name="regions" value="Quezon City Operation"> Quezon City</label>
                    <label><input type="checkbox" name="regions" value="NCR South Operation"> NCR South</label>
                    <label><input type="checkbox" name="regions" value="NCR North Operation"> NCR North</label>
                    <label><input type="checkbox" name="regions" value="CAMANA Operation"> CAMANA</label>
                    <label><input type="checkbox" name="regions" value="Pampanga Operation"> Pampanga</label>
                </div>

                <!-- Admin override warning -->
                <div id="adminWarning"
                    style="display: none; background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; padding: 12px; margin-top: 16px; font-size: 13px; color: #b45309; text-align: left; line-height: 1.5;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <strong style="color: #92400e;">⚠️ Admin Access Warning</strong><br>
                            <span id="adminWarningText">
                                <span id="adminOverride"
                                    style="text-decoration: underline; cursor: pointer; font-weight: bold;">You</span>
                                are selecting all regions.Kindly select only the
                                regions assigned to you.
                            </span>
                        </div>
                        <button type="button" onclick="closeAdminWarning()"
                            style="background: transparent; border: none; color: #92400e; font-size: 18px; cursor: pointer; padding: 0 4px; line-height: 1;">&times;</button>
                    </div>
                </div>


            </fieldset>

            <div style="margin-top:16px;text-align:right; display: flex; gap: 10px; justify-content:flex-end;">
                <button onclick="closeRegisterModal()" class="btn secondary" type="button">Cancel</button>
                <button id="confirmRegister" class="btn primary" type="button">Register</button>
            </div>
        </div>
    </div>

    <!-- Ticket Search Modal -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTicketModal()">&times;</span>
            <header class="modal-header">
                <img src="https://imgur.com/ykZQl3d.png" alt="YTO Logo" style="height: 70px; margin-bottom: 10px;" />
                <h2>🔧 YTO Express IT Ticket Lookup</h2>
            </header>
            <div class="search-box">
                <input type="text" id="ticketInput" placeholder="Enter Ticket Number (e.g., IT-Repair-4816)" />
                <button onclick="searchTicket()">Search</button>
            </div>
            <div id="notification" class="notification"></div>
            <div id="result" class="result"></div>
        </div>
    </div>

    <!-- Ticket Request Modal -->
    <div id="requestModal" class="modal">
        <div class="modal-content">
            <div class="generating-overlay">
                <div class="spinner"></div>
                <p>Please wait while ticket number is being generated...</p>
            </div>
            <span class="close" onclick="closeRequestModal()">&times;</span>
            <header class="modal-header">
                <img src="https://imgur.com/ykZQl3d.png" alt="YTO Logo" style="height: 70px; margin-bottom: 10px;" />
                <h2>📝 Submit New Ticket</h2>
            </header>
            <form id="ticketForm" autocomplete="off">
                <div class="form-grid">
                    <div>
                        <label>Ticket Number (Auto-generated)</label>
                        <input type="text" id="ticketNumber" name="ticketNumber" readonly
                            style="color: red; font-weight: bold;" />
                    </div>
                    <div>
                        <label for="assetCode">Asset Code</label>
                        <input type="text" id="assetCode" name="assetCode" placeholder="Enter I.T. Dept. Asset Code" />
                    </div>
                    <div>
                        <label for="regionSelect">Region</label>
                        <select id="regionSelect" name="region" required onchange="onRegionChange()">
                            <option value="">-- Select Region --</option>
                            <option>Batangas Operation</option>
                            <option>Laguna Operation</option>
                            <option>Cavite Operation</option>
                            <option>CARMONA Operation</option>
                            <option>Manila Operation</option>
                            <option>Bulacan Operation</option>
                            <option>NCR North Operation</option>
                            <option>NCR South Operation</option>
                            <option>Quezon City Operation</option>
                            <option>CAMANA Operation</option>
                            <option>Pampanga Operation</option>
                        </select>
                    </div>
                    <div>
                        <label for="branchSelect">Branch</label>
                        <select id="branchSelect" name="branch" required>
                            <option value="">-- Select Branch --</option>
                        </select>
                    </div>
                    <div>
                        <label>Report By</label>
                        <input type="text" id="reportBy" name="reportBy" required placeholder="Your name / Reporter" />
                    </div>
                    <div>
                        <label>Device Type</label>
                        <select id="deviceType" name="deviceType" required onchange="onDeviceTypeChange()">
                            <option value="">-- Select Device --</option>
                        </select>
                    </div>
                    <div id="deviceNameContainer" style="display:none">
                        <label>Please specify device name</label>
                        <input type="text" id="deviceName" name="deviceName" placeholder="e.g., Canon LBP 2900" />
                    </div>
                    <div class="full">
                        <label>Problem Description</label>
                        <textarea id="problemDescription" name="problemDescription" required
                            placeholder="Describe the issue..."></textarea>
                    </div>
                    <div class="full">
                        <label>Photo Proof (optional but recommended)</label>
                        <div style="background: rgba(255,255,255,0.03); padding:8px; border-radius:10px;">
                            <input id="photoProof" type="file" name="photoProof" accept="image/*" />
                        </div>
                    </div>
                </div>
                <div class="submit-row">
                    <button type="submit" class="submit-btn">Submit Ticket</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="success-modal" aria-hidden="true">
        <div class="success-content" role="dialog" aria-modal="true" aria-labelledby="successTitle">
            <h2 id="successTitle">✅ Ticket Submitted!</h2>
            <p style="opacity:0.95; text-align:center;">Please take note of your Ticket Number</p>
            <p id="modalTicket"
                style="font-size:25px; font-weight:800; margin-top:8px; color: #ff5252; text-align:center;"></p>
            <p id="modalDate" style="font-size:13px; opacity:0.9; margin-top:6px; text-align:center;"></p>
            <div style="display:flex; gap:10px; margin-top:14px; justify-content:center;">
                <button onclick="copyTicketNumber()"
                    style="padding:10px 12px; border-radius:8px; border:none; background:rgba(255,255,255,0.12); color:#fff; cursor:pointer">📋
                    Copy Ticket Number</button>
                <button onclick="closeSuccessModal()"
                    style="padding:10px 12px; border-radius:8px; border:none; background:#fff; color:var(--brand-2); font-weight:700; cursor:pointer">OK</button>
            </div>
        </div>
    </div>

    <!-- Spinner Overlay -->
    <div id="spinnerOverlay" class="spinner-overlay" aria-hidden="true">
        <div class="spinner-box">
            <div class="spinner" aria-hidden="true"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Weather Effects Container -->
    <div id="weather-effects-container"></div>

    <script>
        /* ---------------------------
           Theme toggle (persist)
           --------------------------- */
        // Theme is now consistently light glassmorphic, so the toggle is removed.

        /* ---------------------------
           Admin Role Warning Logic
           --------------------------- */
        const regionCheckboxesContainer = document.getElementById('regionCheckboxes');
        const allRegionCheckboxes = regionCheckboxesContainer.querySelectorAll('input[type="checkbox"]');
        const adminWarning = document.getElementById('adminWarning');
        let adminOverrideClicked = false;

        regionCheckboxesContainer.addEventListener('change', () => {
            const checkedCount = regionCheckboxesContainer.querySelectorAll('input[type="checkbox"]:checked').length;
            if (checkedCount === allRegionCheckboxes.length && !adminOverrideClicked) {
                adminWarning.style.display = 'block';
            } else {
                adminWarning.style.display = 'none';
            }
        });

        document.getElementById('adminOverride').addEventListener('click', () => {
            adminOverrideClicked = true;
            adminWarning.style.display = 'none';
            showToast('Admin access override confirmed.', 'info', 2000);
        });

        function closeAdminWarning() {
            adminWarning.style.display = 'none';
        }

        /* ---------------------------
           Modal helpers
           --------------------------- */
        const ticketModal = document.getElementById('ticketModal');
        const requestModal = document.getElementById('requestModal');
        const successModal = document.getElementById('successModal');
        const spinnerOverlay = document.getElementById('spinnerOverlay');
        const loginModal = document.getElementById('loginModal');
        const securityModal = document.getElementById('securityModal');
        const registerModal = document.getElementById('registerModal');
        let existingTicketNumbers = new Set();
        let deviceTypeList = []; // To store the list of devices

        function openTicketModal() { ticketModal.classList.add('show'); ticketModal.setAttribute('aria-hidden', 'false'); }
        function closeTicketModal() {
            document.getElementById("ticketModal").classList.remove("show");
            document.getElementById("ticketModal").setAttribute("aria-hidden", "true");

            // reset fields
            document.getElementById("ticketInput").value = "";
            document.getElementById("result").innerHTML = "";
            document.getElementById("notification").innerHTML = "";
        }

        function openLoginModal() { loginModal.classList.add('show'); loginModal.setAttribute('aria-hidden', 'false'); }
        function closeLoginModal() { loginModal.classList.remove('show'); loginModal.setAttribute('aria-hidden', 'true'); }
        function closeSecurityModal() {
            securityModal.classList.remove('show');
            securityModal.setAttribute('aria-hidden', 'true');
            openLoginModal(); // Re-open the login modal
        }
        function closeRegisterModal() { registerModal.classList.remove('show'); registerModal.setAttribute('aria-hidden', 'true'); resetRegisterForm(); }

        function closeRequestModal() {
            adminOverrideClicked = false; // Reset override flag when closing
            closeAdminWarning(); // Ensure warning is hidden
            const modal = document.getElementById("requestModal");
            modal.classList.remove("show");
            modal.setAttribute("aria-hidden", "true");

            // Reset the form
            const form = document.getElementById("ticketForm");
            if (form) form.reset();

            // Reset branch dropdown
            const branchSelect = document.getElementById("branchSelect");
            if (branchSelect) branchSelect.innerHTML = '<option value="">-- Select Branch --</option>';

            // Hide device name field
            const deviceNameContainer = document.getElementById("deviceNameContainer");
            if (deviceNameContainer) deviceNameContainer.style.display = "none";

            // Generate a new ticket number for next time
            generateTicketNumber();
        }


        function openRequestModal() {
            // Show the modal immediately for better UX
            requestModal.classList.add('show');
            requestModal.setAttribute('aria-hidden', 'false');

            // Show the generating overlay
            const overlay = requestModal.querySelector('.generating-overlay');
            overlay.style.display = 'flex';

            // Fetch tickets and generate the unique number in the background
            fetchDeviceTypes(); // Fetch device types when modal is opened
            fetchExistingTickets().then(() => {
                generateTicketNumber();
                overlay.style.display = 'none'; // Hide overlay when done
            });
        }

        function closeRequestModal() { requestModal.classList.remove('show'); requestModal.setAttribute('aria-hidden', 'true'); }

        function openSuccessModal() { successModal.style.display = 'flex'; successModal.setAttribute('aria-hidden', 'false') }
        function closeSuccessModal() { successModal.style.display = 'none'; successModal.setAttribute('aria-hidden', 'true') }

        // window.addEventListener('click', (e) => {
        //   if (e.target === ticketModal) closeTicketModal();
        //   if (e.target === requestModal) closeRequestModal();
        //   if (e.target === loginModal) closeLoginModal();
        //   if (e.target === securityModal) closeSecurityModal();
        //   if (e.target === registerModal) closeRegisterModal();
        // });

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeTicketModal();
                closeRequestModal();
            }
        });

        /* ---------------------------
           Region -> Branch mapping (full inline)
           --------------------------- */
        const regionBranches = {
            "Batangas Operation": [
                "Balayan Branch",
                "Batangas 1 Branch",
                "Batangas 2 Branch",
                "Bauan Branch",
                "Lemery Branch",
                "Lipa 1 Branch",
                "Lipa 2 Branch",
                "Malvar Branch",
                "Nasugbu Branch",
                "Rosario Branch",
                "San Jose Batangas Branch",
                "San Juan Batangas Branch",
                "Sto Tomas Branch",
                "Talisay Branch",
                "Batangas DC",
                "Batangas Head Office"
            ],
            "Laguna Operation": [
                "Bay Branch",
                "Cabuyao Branch",
                "Calamba 01 Branch",
                "Calamba 02 Branch",
                "Famy Branch",
                "Liliw Branch",
                "San Pablo Branch",
                "San Pedro Branch",
                "Sta Cruz Branch",
                "Sta Rosa Branch",
                "Victoria Branch",
                "Laguna DC",
                "Laguna Head Office"
            ],
            "Cavite Operation": [
                "Alfonso Branch",
                "Bacoor 1 Branch",
                "Bacoor 2 Branch",
                "General Trias Branch",
                "Imus Branch",
                "Indang Branch",
                "Kawit Branch",
                "Naic Branch",
                "Silang Branch",
                "Tagaytay Branch",
                "Tanza Branch",
                "Trece Martires Branch",
                "Dasma 001 Branch",
                "Dasma 002 Branch",
                "Cavite Head Office"
            ],
            "CARMONA Operation": [
                "Cavite DC",
                "Carmona Branch"
            ],
            "Manila Operation": [
                "Tondo Branch",
                "Manila Branch",
                "Sta. Mesa Branch",
                "Pandacan Branch",
                "Tayuman Branch",
                "Malate Branch"
            ],
            "Bulacan Operation": [
                "Marilao Pick-Up Branch",
                "Marilao Delivery Branch",
                "Calumpit Branch",
                "Meycauayan Branch",
                "Bocaue Branch",
                "Santa Maria 1 Branch-San Vicente",
                "Santa Maria 2 Branch- Balasing",
                "Malolos Branch",
                "Paombong Branch",
                "Guiguinto Branch",
                "Pandi Branch",
                "Norzagaray Branch",
                "Plaridel Branch",
                "Baliuag Branch",
                "Valenzuela 01 Branch",
                "Valenzuela 02 Branch",
                "San Ildefonso Branch",
                "San Rafael Branch",
                "San Jose Del Monte 2",
                "Pulilan SC"
            ],
            "NCR North Operation": [
                "Angono 001 Branch",
                "Antipolo 001 Branch",
                "Antipolo 002 Branch",
                "Binangonan 001 Branch",
                "Cainta 001 Branch",
                "Rodriguez 001 Branch",
                "San Mateo 001 Branch",
                "Marikina Branch"
            ],
            "NCR South Operation": [
                "Makati 001 Branch",
                "Taguig 001 Branch",
                "San Juan 001 Branch",
                "Pasig 001 Branch",
                "Las Piñas 001 Branch",
                "Mandaluyong 001 Branch",
                "Pasig 002 Branch",
                "Muntinlupa 001 Branch",
                "Pasay 001 Branch",
                "Parañaque 001 Branch",
                "Pateros 001 Branch",
                "Parañaque 002 Branch",
                "Muntinlupa 002 Branch",
                "Las Piñas 002 Branch",
                "Makati 002 Branch",
                "Pasig 003 Branch",
                "Pasay 002 Branch"
            ],
            "Quezon City Operation": [
                "Quezon City 001 Branch",
                "Quezon City 002 Branch",
                "Quezon City 003 Branch",
                "Quezon City 004 Branch",
                "Quezon City 005 Branch",
                "Quezon City 006 Branch",
                "Quezon City 007 Branch",
                "Quezon City 008 Branch",
                "Quezon City 009 Branch",
                "Quezon City 010 Branch"
            ],
            "CAMANA Operation": [
                "North Caloocan 001 Branch",
                "Navotas 001 Branch",
                "North Caloocan 002 Branch",
                "South Caloocan 001 Branch",
                "Malabon 001 Branch",
                "South Caloocan 002 Branch"
            ],
            "Pampanga Operation": [
                "Lubao Branch",
                "Angeles City 001 Branch",
                "Angeles City 002 Branch",
                "Arayat Branch",
                "Bacolor Branch",
                "San Simon Branch",
                "Mabalacat Branch",
                "Apalit Branch",
                "Mexico Branch",
                "San Fernando Branch"
            ]
        };

        const regionSelect = document.getElementById('regionSelect');
        const branchSelect = document.getElementById('branchSelect');

        function onRegionChange() {
            const region = regionSelect.value;
            // reset branch to default
            branchSelect.innerHTML = '<option value="">-- Select Branch --</option>';
            if (regionBranches[region]) {
                regionBranches[region].forEach(b => {
                    const opt = document.createElement('option');
                    opt.value = b; opt.textContent = b;
                    branchSelect.appendChild(opt);
                });
            }
        }

        /* ---------------------------
           Device type toggle
           --------------------------- */
        const deviceType = document.getElementById('deviceType');
        const deviceNameContainer = document.getElementById('deviceNameContainer');
        function onDeviceTypeChange() {
            const v = deviceType.value || '';
            deviceNameContainer.style.display = v.startsWith('Others') ? 'block' : 'none';
        }

        /* ---------------------------
           Ticket number generator
           --------------------------- */
        const ticketNumberInput = document.getElementById('ticketNumber');
        async function fetchExistingTickets() {
            try {
                const res = await fetch('https://script.google.com/macros/s/AKfycbwTiDXSQ9sHFnsNGZudsFVH3bKqGeAOHTSCQpfqGXT-FYp2zmYCcS0xYW3zJmmsgAg/exec');
                const tickets = await res.json();
                existingTicketNumbers = new Set(tickets.map(t => t.colA));
            } catch (error) {
                console.error("Could not fetch existing tickets:", error);
                // Proceed without duplicate check if fetch fails
            }
        }

        function generateTicketNumber() {
            let num;
            let attempts = 0;
            do {
                num = 'IT-Repair-' + String(Math.floor(Math.random() * 99999 + 1)).padStart(5, '0');
                attempts++;
            } while (existingTicketNumbers.has(num) && attempts < 100); // Failsafe after 100 tries

            ticketNumberInput.value = num; // Set the unique number
        }

        // generate on initial load as fallback
        // generateTicketNumber(); // Now called when modal opens

        /* ---------------------------
           Toast helper
           --------------------------- */
        let toastTimer = null;

        function showToast(message, type = "info", duration = 3000) {
            // Remove any existing toast first
            const existingToast = document.querySelector('.toast.show');
            if (existingToast) {
                existingToast.classList.remove('show');
                setTimeout(() => existingToast.remove(), 500);
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`; // type can be 'success', 'error', 'info'

            const icons = { success: '✅', error: '❌', info: 'ℹ️' };
            toast.innerHTML = `<div class="toast-icon">${icons[type] || '🔔'}</div><div>${message}</div>`;

            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 50);
            toastTimer = setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, duration);
        }

        /* ---------------------------
           File -> Base64 helper
           --------------------------- */
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = err => reject(err);
                reader.readAsDataURL(file);
            });
        }

        /* ---------------------------
           Submission logic (keeps original endpoint)
           --------------------------- */
        const ticketForm = document.getElementById('ticketForm');
        ticketForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // simple validation & highlights
            const requiredFields = [
                document.getElementById('regionSelect'),
                document.getElementById('branchSelect'),
                document.getElementById('reportBy'),
                document.getElementById('deviceType'),
                document.getElementById('problemDescription')
            ];
            let ok = true;
            requiredFields.forEach(f => {
                if (!f.value || f.value.trim() === '') {
                    f.classList.add('error'); ok = false;
                } else { f.classList.remove('error') }
            });
            if (!ok) { showToast('Please fill in all required fields.', 'error'); return; }

            // show spinner + toast
            spinnerOverlay.classList.add('show');
            spinnerOverlay.style.display = 'flex';
            showToast('Now submitting request...', 2500);

            // prepare FormData similar to original
            const formData = new FormData();
            formData.append('ticketNumber', document.getElementById('ticketNumber').value);
            formData.append('region', regionSelect.value);
            formData.append('assetCode', document.getElementById('assetCode').value);
            formData.append('branch', branchSelect.value);
            formData.append('reportBy', document.getElementById('reportBy').value);
            formData.append('deviceType', deviceType.value);
            // include deviceName if visible
            const deviceName = document.getElementById('deviceName');
            if (deviceName && deviceName.value) formData.append('deviceName', deviceName.value);
            formData.append('problemDescription', document.getElementById('problemDescription').value);

            // photoProof: convert to Base64 then set as "photoProof" (matching original)
            const photoInput = document.getElementById('photoProof');
            if (photoInput && photoInput.files.length > 0) {
                try {
                    const base64 = await fileToBase64(photoInput.files[0]); // data:[...],base64...
                    formData.append('photoProof', base64);
                } catch (err) {
                    console.error('File read error', err);
                    showToast('Failed to read attachment.', 'error');
                }
            } else {
                // empty string as in original
                formData.append('photoProof', '');
            }

            // disable submit button to avoid duplicates
            const submitBtn = ticketForm.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                // POST to the same Apps Script endpoint
                const endpoint = 'https://script.google.com/macros/s/AKfycbwTiDXSQ9sHFnsNGZudsFVH3bKqGeAOHTSCQpfqGXT-FYp2zmYCcS0xYW3zJmmsgAg/exec';
                const res = await fetch(endpoint, { method: 'POST', body: formData });
                const result = await res.json();

                // The Apps Script returns a JSON object with a success property
                if (result && result.success) {
                    showToast('Ticket submitted successfully!', 'success', 2500);
                    // put ticket info in success modal
                    const tnum = document.getElementById('ticketNumber').value;
                    document.getElementById('modalTicket').textContent = tnum;
                    document.getElementById('modalDate').textContent = new Date().toLocaleString();
                    // show success modal (note: per your instruction, only closed by user)
                    openSuccessModal();

                    // reset form and generate new ticket
                    ticketForm.reset();
                    branchSelect.innerHTML = '<option value="">-- Select Branch --</option>';
                    document.getElementById('deviceNameContainer').style.display = 'none';
                    setTimeout(() => { submitBtn.disabled = false; submitBtn.textContent = 'Submit Ticket'; }, 1200);
                    generateTicketNumber();
                } else {
                    // some error
                    console.error('Submission response:', result);
                    showToast('Error submitting ticket. Try again.', 'error', 3000);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit Ticket';
                }
            } catch (err) {
                console.error(err);
                showToast('Internet Connection error. Try again.', 'error', 3000);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Ticket';
            } finally {
                // hide spinner
                spinnerOverlay.classList.remove('show');
                spinnerOverlay.style.display = 'none';
            }
        });

        function openSuccessModal() {
            successModal.style.display = 'flex';
            successModal.setAttribute('aria-hidden', 'false');
        }
        function closeSuccessModal() {
            successModal.style.display = 'none';
            successModal.setAttribute('aria-hidden', 'true');
        }

        function copyTicketNumber() {
            const t = document.getElementById('modalTicket').textContent;
            if (!t) return;
            navigator.clipboard.writeText(t).then(() => showToast('Ticket number copied!', 'success')).catch(() => showToast('Failed to copy', 'error'));
        }

        /* ---------------------------
           Search ticket (same endpoint as before)
           --------------------------- */
        async function searchTicket() {
            const q = document.getElementById('ticketInput').value.trim();
            const resultBox = document.getElementById('result');
            const notify = document.getElementById('notification');
            resultBox.innerHTML = '';
            notify.textContent = '';
            if (!q) { resultBox.innerHTML = '<p style="color:#ef4444">Please enter a ticket number</p>'; return; }

            notify.textContent = 'Now searching your ticket.....';
            try {
                const url = 'https://script.google.com/macros/s/AKfycbwTiDXSQ9sHFnsNGZudsFVH3bKqGeAOHTSCQpfqGXT-FYp2zmYCcS0xYW3zJmmsgAg/exec?ticket=' + encodeURIComponent(q);
                const res = await fetch(url);
                const text = await res.text();
                let data;
                try { data = JSON.parse(text); } catch (err) {
                    notify.textContent = '';
                    resultBox.innerHTML = '<p style="color:#ef4444">Invalid response from server.</p>';
                    return;
                }
                notify.textContent = '';
                if (data.error) {
                    resultBox.innerHTML = `<p style="color:#ef4444">${data.error}</p>`;
                } else {
                    const status = data.status || "N/A";
                    const statusClass = getStatusClass(status);
                    resultBox.innerHTML = `
                        <div class="result-grid">
                            <div class="label">🎫 Ticket #:</div>
                            <div class="value"><strong>${data.ticket || "N/A"}</strong></div>
                            <div class="label">🔩 Asset Code:</div>
                            <div class="value">${data.assetCode || "N/A"}</div>
                            <div class="label">� Region:</div>
                            <div class="value">${data.region || "N/A"}</div>
                            <div class="label">🏢 Branch:</div>
                            <div class="value">${data.branch || "N/A"}</div>
                            <div class="label">👨‍💻 IT Personnel:</div>
                            <div class="value">${data.itPersonnel || "N/A"}</div>
                            <div class="label">📌 Status:</div>
                            <div class="value"><span class="status-badge ${statusClass}">${status}</span></div>
                            <div class="label">💬 Remarks:</div>
                            <div class="value">${data.remarks || "N/A"}</div>
                        </div>
                    `;
                }
            } catch (err) {
                console.error(err);
                document.getElementById('notification').textContent = '';
                resultBox.innerHTML = '<p style="color:#ef4444">Error fetching ticket data. Please try again later.</p>';
            }
        }

        function getStatusClass(status) {
            if (!status) return "status-pending";
            const s = status.toLowerCase();
            if (s.includes("completed")) return "status-completed";
            if (s.includes("in-progress")) return "status-inprogress";
            if (s.includes("open")) return "status-pending"; // Or a specific 'open' class
            return "status-pending"; // Default
        }


        /* ---------------------------
           Accessibility & initial behaviors
           --------------------------- */
        // make sure branch resets when region changes on load (if region had value)
        regionSelect.addEventListener('change', onRegionChange);

        // when opening request modal, focus first required field
        document.querySelectorAll('.small-btn').forEach(btn => {
            btn.addEventListener('click', () => setTimeout(() => document.getElementById('regionSelect').focus(), 300));
        });

        window.addEventListener("load", () => {
            document.body.classList.add("loaded");
            // Automatically open the "Submit Ticket" modal on page load
            // Check for a query parameter to decide if we should open it.
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('action') === 'submit') {
                openRequestModal();

                // When in an iframe, make the modal scrollable if content overflows
                const requestModalContent = document.querySelector('#requestModal .modal-content');
                if (requestModalContent) {
                    requestModalContent.style.overflowY = 'auto';
                }

                // When opened in an iframe, hide the modal's own close button
                // because the parent iframe modal already has one.
                const requestModalCloseBtn = document.querySelector('#requestModal .close');
                if (requestModalCloseBtn) {
                    requestModalCloseBtn.style.display = 'none';
                }
            }
        });

        /* ---------------------------
           Weather Effects Logic
           --------------------------- */
        function showWeatherEffect(weatherMain) {
            const container = document.getElementById('weather-effects-container');
            container.innerHTML = ''; // Clear previous effects

            let effectType = '';
            const main = weatherMain.toLowerCase();

            if (main.includes('rain') || main.includes('drizzle') || main.includes('thunderstorm')) {
                effectType = 'rain';
            } else if (main.includes('snow')) {
                effectType = 'snow';
            } else if (main.includes('clear')) {
                effectType = 'clear';
            }

            if (!effectType) return; // No effect for this weather

            // Create and append elements for the effect
            if (effectType === 'rain') {
                for (let i = 0; i < 100; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = `${Math.random() * 100}vw`;
                    drop.style.animationDuration = `${0.2 + Math.random() * 0.3}s`;
                    drop.style.animationDelay = `${Math.random() * 2}s`;
                    container.appendChild(drop);
                }
            } else if (effectType === 'snow') {
                for (let i = 0; i < 50; i++) {
                    const flake = document.createElement('div');
                    flake.className = 'snowflake';
                    flake.style.left = `${Math.random() * 100}vw`;
                    flake.style.animationDuration = `${5 + Math.random() * 10}s`;
                    flake.style.animationDelay = `${Math.random() * 5}s`;
                    flake.style.opacity = Math.random();
                    const size = `${Math.random() * 5 + 2}px`;
                    flake.style.width = size;
                    flake.style.height = size;
                    container.appendChild(flake);
                }
            } else if (effectType === 'clear') {
                for (let i = 0; i < 12; i++) {
                    const ray = document.createElement('div');
                    ray.className = 'sun-ray';
                    ray.style.transform = `rotate(${i * 30}deg)`;
                    ray.style.animationDelay = `${Math.random() * 2}s`;
                    container.appendChild(ray);
                }
            }

            // Show and then hide the effect
            container.classList.add('show');
            setTimeout(() => {
                container.classList.remove('show');
            }, 4000); // Effect lasts for 4 seconds
        }

        function getWeatherData() {
            if (!navigator.geolocation) {
                console.log("Geolocation is not supported by this browser.");
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;
                // IMPORTANT: Replace with your own free OpenWeatherMap API key
                const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY';
                const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}`;

                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    if (data.weather && data.weather.length > 0) {
                        showWeatherEffect(data.weather[0].main);
                    }
                } catch (error) {
                    console.error("Error fetching weather data:", error);
                }
            }, (error) => {
                console.error("Error getting location:", error.message);
            });
        }

        // === LOGIN/REGISTER SCRIPT (from Ticket IT Login.html) ===
        const LOGIN_API_URL = "https://script.google.com/macros/s/AKfycbwTiDXSQ9sHFnsNGZudsFVH3bKqGeAOHTSCQpfqGXT-FYp2zmYCcS0xYW3zJmmsgAg/exec";
        const DASHBOARD_URL = "Ticket Main Dashboard.html";
        const SEC_PASS = "051488";
        const SESSION_KEY = 'it_session';
        const REMEMBER_KEY = 'it_remember_user';

        // Login elements
        const loginFormEl = document.getElementById("loginForm");
        const userEl = document.getElementById("username");
        const passEl = document.getElementById("password");
        const rememberEl = document.getElementById("remember");

        // Register elements
        const createAccountBtn = document.getElementById("createAccountBtn");
        const secInput = document.getElementById("securityInput");
        const secConfirm = document.getElementById("secConfirm");
        const regFullName = document.getElementById("regFullName");
        const regUsername = document.getElementById("regUsername");
        const regPassword = document.getElementById("regPassword");
        const regProfilePic = document.getElementById("regProfilePic");
        const profilePicPreview = document.getElementById("profilePicPreview");
        const confirmRegister = document.getElementById("confirmRegister");

        // Password toggle
        document.getElementById('togglePass').addEventListener('click', () => {
            passEl.type = passEl.type === 'password' ? 'text' : 'password';
        });

        // "Create Account" flow
        createAccountBtn.addEventListener('click', () => {
            closeLoginModal();
            securityModal.classList.add('show');
            setTimeout(() => secInput.focus(), 80);
        });

        secConfirm.addEventListener('click', () => {
            if ((secInput.value || '').trim() === SEC_PASS) {
                closeSecurityModal();
                registerModal.classList.add('show');
                setTimeout(() => regFullName.focus(), 80);
                secInput.value = '';
            } else {
                showToast('Invalid IT Security Password', 'error', 3000);
            }
        });

        // Registration submission
        confirmRegister.addEventListener('click', async () => {
            const fullName = (regFullName.value || '').trim();
            const username = (regUsername.value || '').trim();
            const password = (regPassword.value || '').trim();
            const regions = Array.from(document.querySelectorAll('#registerModal input[name="regions"]:checked')).map(cb => cb.value);

            // Determine userType based on region selection
            const allRegionCheckboxes = document.querySelectorAll('#registerModal input[name="regions"]');
            const userType = regions.length === allRegionCheckboxes.length ? 'Admin' : 'ITStaff';

            if (!fullName || !username || !password || regions.length === 0) {
                showToast('Please fill all fields and select at least one region.', 'error', 3000);
                return;
            }
            // Disable button and show loading text
            confirmRegister.disabled = true;
            confirmRegister.textContent = 'Registering...';

            spinnerOverlay.classList.add('show');
            let profilePicBase64 = '';
            if (regProfilePic.files.length > 0) {
                try {
                    profilePicBase64 = await fileToBase64(regProfilePic.files[0]);
                } catch (err) {
                    showToast('Error reading profile picture.', 'error', 3000);
                    confirmRegister.disabled = false;
                    confirmRegister.textContent = 'Register';
                    spinnerOverlay.classList.remove('show');
                    return;
                }
            }

            try {
                const formData = new FormData();
                formData.append('action', 'registerUser');
                formData.append('fullName', fullName);
                formData.append('username', username);
                formData.append('password', password);
                formData.append('regions', regions.join(","));
                formData.append('userType', userType); // Add userType to the form data
                if (profilePicBase64) formData.append('profilePic', profilePicBase64);

                const resp = await fetch(LOGIN_API_URL, { method: 'POST', body: formData });
                const data = await resp.json();

                if (data && data.success) {
                    showToast('Account created! Please log in.', 'success', 3000);
                    closeRegisterModal();
                    openLoginModal();
                } else {
                    showToast(data?.message || 'Registration failed. Username might be taken.', 'error', 4000);
                }
            } catch (err) {
                showToast('Error creating account. Check console.', 'error', 4000);
            } finally {
                // Always re-enable the button and reset text, regardless of success or failure
                confirmRegister.disabled = false;
                confirmRegister.textContent = 'Register';
                spinnerOverlay.classList.remove('show');
            }
        });

        // Login submission
        loginFormEl.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = (userEl.value || '').trim();
            const password = (passEl.value || '').trim();
            if (!username || !password) { showToast('Enter username and password', 'error', 3000); return; }

            spinnerOverlay.classList.add('show'); // Make spinner visible
            try {
                const url = new URL(LOGIN_API_URL);
                url.searchParams.set('action', 'loginUser');
                url.searchParams.set('username', username);
                url.searchParams.set('password', password);

                const resp = await fetch(url.toString(), { method: 'GET' });
                const data = await resp.json();

                if (data && data.success) {
                    const sessionData = {
                        username: username,
                        fullName: data.fullName || username,
                        userType: data.userType || 'User',
                        regions: data.regions || [],
                        profilePicUrl: data.profilePicUrl || '',
                        email: data.email || '',
                        contactNumber: data.contactNumber || '',
                        ts: Date.now()
                    };
                    localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
                    if (rememberEl.checked) localStorage.setItem(REMEMBER_KEY, username);
                    else localStorage.removeItem(REMEMBER_KEY);

                    showToast("Login successful. Redirecting...", 'success', 2000);
                    setTimeout(() => { window.location.href = DASHBOARD_URL; }, 1500);
                } else {
                    showToast('Invalid username or password', 'error', 3000);
                    spinnerOverlay.classList.remove('show'); // Hide spinner on failure
                }
            } catch (err) {
                showToast('Login error. Check network.', 'error', 3000);
                spinnerOverlay.classList.remove('show'); // Hide spinner on error
            } finally {
                // This block is a good place for cleanup, but the logic is handled above for now.
            }
        });

        // Image preview for registration
        regProfilePic.addEventListener('change', function () {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { profilePicPreview.src = e.target.result; }
                reader.readAsDataURL(this.files[0]);
            }
        });

        function resetRegisterForm() {
            regFullName.value = '';
            regUsername.value = '';
            regPassword.value = '';
            regProfilePic.value = '';
            profilePicPreview.src = 'https://imgur.com/5BqVMpY.png';
            document.querySelectorAll('#registerModal input[name="regions"]:checked').forEach(cb => cb.checked = false);
            adminOverrideClicked = false; // Reset the override flag
            closeAdminWarning(); // Hide the warning
        }

        // Remember me functionality
        (function bootLogin() {
            const remembered = localStorage.getItem(REMEMBER_KEY);
            if (remembered) { userEl.value = remembered; rememberEl.checked = true; }
        })();

        async function fetchDeviceTypes() {
            // This function will only run once to avoid re-fetching
            if (deviceTypeList.length > 0) return;

            try {
                // Use the same API URL as the login/registration functions
                const url = new URL(LOGIN_API_URL);
                url.searchParams.set('action', 'getDeviceTypes');

                const response = await fetch(url);
                const result = await response.json();

                if (result && result.success && Array.isArray(result.data)) {
                    deviceTypeList = result.data.sort();
                    const deviceSelect = document.getElementById('deviceType');
                    deviceSelect.innerHTML = '<option value="">-- Select Device --</option>'; // Clear existing
                    deviceTypeList.forEach(device => {
                        const option = document.createElement('option');
                        option.value = device;
                        option.textContent = device;
                        deviceSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error("Failed to fetch device types:", error);
                showToast('Could not load device list.', 'error');
            }
        }

        /* ---------------------------
           Weather Effects Logic
           --------------------------- */
        function showWeatherEffect(weatherMain) {
            const container = document.getElementById('weather-effects-container');
            container.innerHTML = ''; // Clear previous effects

            let effectType = '';
            const main = weatherMain.toLowerCase();

            if (main.includes('rain') || main.includes('drizzle') || main.includes('thunderstorm')) {
                effectType = 'rain';
            } else if (main.includes('snow')) {
                effectType = 'snow';
            } else if (main.includes('clear')) {
                effectType = 'clear';
            }

            if (!effectType) return; // No effect for this weather

            // Create and append elements for the effect
            if (effectType === 'rain') {
                for (let i = 0; i < 100; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = `${Math.random() * 100}vw`;
                    drop.style.animationDuration = `${0.2 + Math.random() * 0.3}s`;
                    drop.style.animationDelay = `${Math.random() * 2}s`;
                    container.appendChild(drop);
                }
            } else if (effectType === 'snow') {
                for (let i = 0; i < 50; i++) {
                    const flake = document.createElement('div');
                    flake.className = 'snowflake';
                    flake.style.left = `${Math.random() * 100}vw`;
                    flake.style.animationDuration = `${5 + Math.random() * 10}s`;
                    flake.style.animationDelay = `${Math.random() * 5}s`;
                    flake.style.opacity = Math.random();
                    const size = `${Math.random() * 5 + 2}px`;
                    flake.style.width = size;
                    flake.style.height = size;
                    container.appendChild(flake);
                }
            } else if (effectType === 'clear') {
                for (let i = 0; i < 12; i++) {
                    const ray = document.createElement('div');
                    ray.className = 'sun-ray';
                    ray.style.transform = `rotate(${i * 30}deg)`;
                    ray.style.animationDelay = `${Math.random() * 2}s`;
                    container.appendChild(ray);
                }
            }

            // Show and then hide the effect
            container.classList.add('show');
            setTimeout(() => {
                container.classList.remove('show');
            }, 4000); // Effect lasts for 4 seconds
        }

        function getWeatherData() {
            if (!navigator.geolocation) {
                console.log("Geolocation is not supported by this browser.");
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;
                // IMPORTANT: Replace with your own free OpenWeatherMap API key
                const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY';
                const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}`;

                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    if (data.weather && data.weather.length > 0) {
                        showWeatherEffect(data.weather[0].main);
                    }
                } catch (error) {
                    console.error("Error fetching weather data:", error);
                }
            }, (error) => {
                console.error("Error getting location:", error.message);
            });
        }

        // Internet connection status
        window.addEventListener('offline', () => {
            showToast('No Internet Connection. You are currently offline.', 'error', 5000);
        });

        window.addEventListener('online', () => {
            showToast('Connection Restored. You are back online!', 'success', 3000);
            // If we need to re-fetch anything on this page when connection is back
            if (document.getElementById('requestModal').classList.contains('show')) {
                fetchExistingTickets().then(generateTicketNumber);
                fetchDeviceTypes();
            }
        });

        /* === NEW: Manual Icon Notification Logic === */
        document.addEventListener('DOMContentLoaded', () => {
            const manualNotification = document.getElementById('manualNotification');

            // Function to show and then hide the notification
            function showManualNotification() {
                manualNotification.style.opacity = '1';
                manualNotification.style.transform = 'translateY(0) scale(1)';

                setTimeout(() => {
                    manualNotification.style.opacity = '0';
                    manualNotification.style.transform = 'translateY(10px) scale(0.95)';
                }, 3000); // Hide after 3 seconds
            }
            setInterval(showManualNotification, 10000); // Show every 10 seconds
        });
    </script>

</body>

</html>